<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ØªØµÙ†ÙŠÙ Ø§Ù„ÙÙŠÙØ§ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± â€” ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#0b74ff;--glass:rgba(255,255,255,0.03)}
    html,body{height:100%}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Noto Naskh Arabic',Arial;background:linear-gradient(180deg,#071021 0%, #07162a 100%);color:#e6eef6;padding:18px;box-sizing:border-box}
    h1{font-size:1.4rem;margin:0 0 10px}
    .wrap{max-width:980px;margin:0 auto}
    .card{background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    label{display:block;margin-top:8px;color:var(--muted);font-size:0.95rem}
    input,select,button{font-size:0.95rem;border-radius:8px;padding:8px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    input::placeholder{color:rgba(255,255,255,0.35)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .col{flex:1 1 180px;min-width:120px}
    button.primary{background:var(--accent);border:0;color:white;padding:9px 12px;cursor:pointer;border-radius:10px}
    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:center}
    th{color:var(--muted);font-weight:600;font-size:0.95rem}
    td .flag{font-size:1.5rem}
    .small{font-size:0.85rem;color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .right{margin-left:auto}
    .danger{background:#c0392b}
    .success{background:#16a34a}
    .export{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:7px 10px;border-radius:8px;color:var(--muted);cursor:pointer}
    footer{margin-top:18px;color:var(--muted);font-size:0.82rem;text-align:center}
    @media (max-width:680px){.row{flex-direction:column}.col{min-width:unset}th,td{font-size:0.85rem}}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ØªØµÙ†ÙŠÙ Ø§Ù„ÙÙŠÙØ§ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± â€” ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©</h1>
    <div class="card small">Ù‡Ø°Ø§ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙŠØ­Ø³Ø¨ ØªØ­Ø¯ÙŠØ« Ù†Ù‚Ø§Ø· Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨Ø¶Ø¨Ø· Ø­Ø³Ø¨ ØµÙŠØºØ© Ø§Ù„Elo Ø§Ù„Ù„ÙŠ ØªØ³ØªØ¹Ù…Ù„Ù‡Ø§ FIFA: <code>P_new = P_old + I Ã— (W - W_e)</code>. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ®Ø²Ù‘Ù† Ù…Ø­Ù„ÙŠØ§Ù‹ ÙØ§Ù„Ù…ØªØµÙØ­.</div>

    <div class="card" id="teamsCard">
      <h2>1) Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ®Ø¨</h2>
      <div class="row">
        <div class="col">
          <label>Ø§Ù„Ø¹Ù„Ù… (Ø¥ÙŠÙ…ÙˆØ¬ÙŠ) â€” Ù…Ø«Ø§Ù„: ğŸ‡²ğŸ‡¦ ÛŒØ§ ğŸ‡«ğŸ‡·</label>
          <input id="inpFlag" placeholder="Ù…Ø«Ø§Ù„: ğŸ‡²ğŸ‡¦" />
        </div>
        <div class="col">
          <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ®Ø¨</label>
          <input id="inpName" placeholder="Ù…Ø«Ø§Ù„: Morocco - Ø§Ù„Ù…ØºØ±Ø¨" />
        </div>
        <div class="col">
          <label>Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
          <input id="inpPoints" type="number" value="1500" />
        </div>
        <div style="align-self:end">
          <button class="primary" id="addTeamBtn">Ø£Ø¶Ù Ø§Ù„Ù…Ù†ØªØ®Ø¨</button>
        </div>
      </div>

      <table id="teamsTable" style="margin-top:12px">
        <thead><tr><th>#</th><th>Ø¹Ù„Ù…</th><th>Ø§Ù„Ù…Ù†ØªØ®Ø¨</th><th>Ù†Ù‚Ø§Ø·</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody></tbody>
      </table>
      <div class="small" style="margin-top:8px">Ù…Ù„Ø§Ø­Ø¸Ø©: ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø£Ùˆ Ø­Ø°Ù Ø£ÙŠ Ù…Ù†ØªØ®Ø¨. Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠØ§Ù‹.</div>
    </div>

    <div class="card" id="matchCard">
      <h2>2) Ø³Ø¬Ù„ Ù…Ø¨Ø§Ø±Ø§Ø© (ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØºÙŠÙŠØ± ÙÙˆØ±Ø§Ù‹)</h2>
      <div class="row">
        <div class="col">
          <label>Ø§Ù„Ù…Ù†ØªØ®Ø¨</label>
          <select id="selA"></select>
        </div>
        <div class="col">
          <label>Ù…Ù‚Ø§Ø¨Ù„</label>
          <select id="selB"></select>
        </div>
        <div class="col">
          <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© (I)</label>
          <select id="selI">
            <option value="5">ÙˆØ¯ÙŠØ© Ø®Ø§Ø±Ø¬ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠÙØ§ (I=5)</option>
            <option value="10">ÙˆØ¯ÙŠØ© Ø¯Ø§Ø®Ù„ Ù†Ø§ÙØ°Ø© Ø§Ù„ÙÙŠÙØ§ (I=10)</option>
            <option value="15">Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ù…Ù… (Ù…Ø¬Ù…ÙˆØ¹Ø§Øª) (I=15)</option>
            <option value="25">ØªØµÙÙŠØ§Øª / Play-offs / Ù…Ø¤Ù‡Ù„Ø§Øª (I=25)</option>
            <option value="35">Ù‚Ø¨Ù„ Ø±Ø¨Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (I=35)</option>
            <option value="40">Ø±Ø¨Ø¹/Ù†ØµÙ/Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ù…Ø±ÙƒØ² Ø§Ù„Ø«Ø§Ù„Ø«/Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (I=40)</option>
            <option value="50">Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… Ù‚Ø¨Ù„ Ø±Ø¨Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (I=50)</option>
            <option value="60">Ø±Ø¨Ø¹/Ù†ØµÙ/Ù†Ù‡Ø§Ø¦ÙŠ ÙƒØ£Ø³ Ø§Ù„Ø¹Ø§Ù„Ù… (I=60)</option>
          </select>
        </div>
        <div class="col">
          <label>Ø§Ù„Ù†ØªÙŠØ¬Ø©</label>
          <select id="selRes">
            <option value="1">Ø§Ù„Ù…Ù†ØªØ®Ø¨ Ø§Ù„Ø£ÙˆÙ„ ÙØ§Ø²</option>
            <option value="0.5">ØªØ¹Ø§Ø¯Ù„</option>
            <option value="0">Ø§Ù„Ù…Ù†ØªØ®Ø¨ Ø§Ù„Ø£ÙˆÙ„ Ø®Ø³Ø±</option>
          </select>
        </div>
        <div style="align-self:end">
          <button class="primary" id="applyMatchBtn">Ø§Ø­Ø³Ø¨ ÙˆØ·Ø¨Ù‘Ù‚</button>
        </div>
      </div>
      <div id="matchInfo" class="small" style="margin-top:10px"></div>
    </div>

    <div class="card">
      <div class="controls">
        <h2>3) Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
        <div class="right">
          <button class="export" id="exportCSV">ØªØµØ¯ÙŠØ± CSV</button>
          <button class="export" id="importCSVBtn">Ø§Ø³ØªÙŠØ±Ø§Ø¯ CSV</button>
          <input type="file" id="importFile" style="display:none" accept=".csv,text/csv" />
          <button class="export" id="resetBtn">Ø¥ÙØ±Ø§Øº Ø§Ù„ÙƒÙ„</button>
        </div>
      </div>

      <table id="ranking">
        <thead><tr><th>Ø§Ù„Ø±ØªØ¨Ø©</th><th>Ø¹Ù„Ù…</th><th>Ø§Ù„Ù…Ù†ØªØ®Ø¨</th><th>Ù†Ù‚Ø§Ø·</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

    <footer class="small">Ù…ØµÙ†ÙˆØ¹ Ù„Ùƒ â€” ØªØµÙ†ÙŠÙ Ø§Ù„ÙÙŠÙØ§ Ø§Ù„Ù…Ø¨Ø§Ø´Ø± â€¢ ÙŠØ­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ù…Ø­Ù„ÙŠØ§Ù‹. ÙÙŠ Ø­Ø§Ù„Ø© Ø±ØºØ¨Øª Ø¨Ù…Ø²Ø§Ù…Ù†Ø© Ø³Ø­Ø§Ø¨ÙŠÙ‘Ø© Ù†Ù‚Ø¯Ø± Ù†Ø±Ù‘Ø¨Ø·Ù‡ Ø¨Ù€ GitHub Ø£Ùˆ Google Sheets Ù„Ø§Ø­Ù‚Ø§Ù‹.</footer>
  </div>

<script>
// ===== Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ =====
const STORAGE_KEY = 'fifa_live_teams_v1';
let teams = [];

// ØªØ­Ù…ÙŠÙ„ Ù…Ù† localStorage
function loadTeams(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    teams = raw ? JSON.parse(raw) : [];
  }catch(e){ teams = []; }
}
function saveTeams(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(teams)); }

// Ø¥Ø¶Ø§ÙØ© ÙØ±ÙŠÙ‚
document.getElementById('addTeamBtn').onclick = ()=>{
  const flag = document.getElementById('inpFlag').value.trim() || '';
  const name = document.getElementById('inpName').value.trim();
  let pts = parseFloat(document.getElementById('inpPoints').value);
  if(!name){ alert('Ø¹Ø·ÙŠÙ†Ø§ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ®Ø¨'); return; }
  if(isNaN(pts)) pts = 1500;
  teams.push({id:Date.now(), flag, name, points: pts});
  saveTeams(); renderAll();
  document.getElementById('inpFlag').value=''; document.getElementById('inpName').value=''; document.getElementById('inpPoints').value='1500';
}

// Ø±Ù†Ø¯Ø± Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ®Ø¨Ø§Øª ÙˆØ§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª
function renderTeamsTable(){
  const tbody = document.querySelector('#teamsTable tbody'); tbody.innerHTML='';
  const selA = document.getElementById('selA'); const selB = document.getElementById('selB'); selA.innerHTML=''; selB.innerHTML='';
  teams.forEach((t,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td><td class="flag">${t.flag||''}</td><td style="text-align:left;padding-left:12px">${t.name}</td><td>${t.points.toFixed(2)}</td>
      <td><button data-id="${t.id}" class="editBtn">ØªØ¹Ø¯ÙŠÙ„</button> <button data-id="${t.id}" class="delBtn danger">Ø­Ø°Ù</button></td>`;
    tbody.appendChild(tr);
    const optA = document.createElement('option'); optA.value = t.id; optA.textContent = t.name; selA.appendChild(optA);
    const optB = optA.cloneNode(true); selB.appendChild(optB);
  });
  document.querySelectorAll('.delBtn').forEach(b=>b.onclick = (e)=>{ const id=+b.dataset.id; teams = teams.filter(x=>x.id!==id); saveTeams(); renderAll(); });
  document.querySelectorAll('.editBtn').forEach(b=>b.onclick = (e)=>{
    const id = +b.dataset.id; const team = teams.find(x=>x.id===id);
    const newName = prompt('Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ®Ø¨:', team.name); if(newName===null) return;
    const newFlag = prompt('Ø§Ù„Ø¹Ù„Ù… (Ø¥ÙŠÙ…ÙˆØ¬ÙŠ):', team.flag||'') ;
    const newPts = prompt('Ø§Ù„Ù†Ù‚Ø§Ø·:', team.points.toFixed(2));
    if(newName) team.name = newName; if(newFlag!==null) team.flag = newFlag;
    const np = parseFloat(newPts); if(!isNaN(np)) team.points = np;
    saveTeams(); renderAll();
  });
}

// ØªØ±ØªÙŠØ¨ ÙˆØ¹Ø±Ø¶ Ø§Ù„ØªØµÙ†ÙŠÙ
function renderRanking(){
  const tb = document.querySelector('#ranking tbody'); tb.innerHTML='';
  const copy = teams.slice().sort((a,b)=>b.points - a.points);
  copy.forEach((t,i)=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${i+1}</td><td class="flag">${t.flag||''}</td><td style="text-align:left;padding-left:12px">${t.name}</td><td>${t.points.toFixed(2)}</td>`;
    tb.appendChild(tr);
  });
}

// Ø±Ù†Ø¯Ø± Ø´Ø§Ù…Ù„
function renderAll(){ renderTeamsTable(); renderRanking(); updateURLInfo(); saveTeams(); }

// ===== Ø­Ø³Ø§Ø¨ Elo (Ø·Ø±ÙŠÙ‚Ø© FIFA) =====
function expectedScore(pA, pB){
  const dr = pB - pA;
  return 1 / (1 + Math.pow(10, dr/600));
}

document.getElementById('applyMatchBtn').onclick = ()=>{
  const idA = +document.getElementById('selA').value;
  const idB = +document.getElementById('selB').value;
  if(!idA || !idB || idA===idB){ alert('Ø§Ø®ØªØ§Ø± Ù…Ù†ØªØ®Ø¨ÙŠÙ† Ù…Ø®ØªÙ„ÙÙŠÙ†'); return; }
  const teamA = teams.find(t=>t.id===idA);
  const teamB = teams.find(t=>t.id===idB);
  const I = parseFloat(document.getElementById('selI').value);
  const W = parseFloat(document.getElementById('selRes').value);

  const WeA = expectedScore(teamA.points, teamB.points);
  const WeB = expectedScore(teamB.points, teamA.points);

  const newA = teamA.points + I*(W - WeA);
  const resultB = 1 - W;
  const newB = teamB.points + I*(resultB - WeB);

  const deltaA = newA - teamA.points;
  const deltaB = newB - teamB.points;

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙŠÙ…
  teamA.points = newA; teamB.points = newB;
  saveTeams(); renderAll();

  document.getElementById('matchInfo').innerHTML = `Ø§Ù„ØªØºÙŠÙŠØ±: <strong>${teamA.name}</strong> ${deltaA.toFixed(2)} Ù†Ù‚Ø§Ø· &nbsp; | &nbsp; <strong>${teamB.name}</strong> ${deltaB.toFixed(2)} Ù†Ù‚Ø§Ø·`;
}

// ===== ØªØµØ¯ÙŠØ± ÙˆØ§Ø³ØªÙŠØ±Ø§Ø¯ CSV =====
function exportCSV(){
  if(teams.length===0){ alert('Ù…Ø§ ÙƒØ§ÙŠÙ† Ø­ØªÙ‰ Ù…Ù†ØªØ®Ø¨ Ù„Ù„ØªØµØ¯ÙŠØ±'); return; }
  const header = ['flag','name','points'];
  const rows = teams.map(t=>[ (t.flag||''), t.name.replace(/"/g,'""'), t.points.toFixed(2) ]);
  const csv = [header.join(',')].concat(rows.map(r=>r.map(c=>`"${c}"`).join(','))).join('\n');
  const blob = new Blob([csv], {type:'text/csv;charset=utf-8;'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'fifa_teams.csv'; document.body.appendChild(a); a.click(); a.remove();
}
document.getElementById('exportCSV').onclick = exportCSV;

document.getElementById('importCSVBtn').onclick = ()=> document.getElementById('importFile').click();
document.getElementById('importFile').onchange = function(e){
  const f = e.target.files[0]; if(!f) return;
  const reader = new FileReader();
  reader.onload = function(){ try{
    const text = reader.result;
    const lines = text.split(/\r?\n/).filter(Boolean);
    const data = lines.slice(1).map(l=>{
      // Ø¨Ø³ÙŠØ·: remove quotes then split by comma (assume no commas in name)
      const cols = l.split(',').map(c=>c.replace(/^"|"$/g,''));
      return {flag: cols[0], name: cols[1], points: parseFloat(cols[2])||1500 };
    });
    // Ø£Ø¯Ø®Ù„ Ù…Ø¹ Ø§Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ ids
    data.forEach(d=>teams.push({id:Date.now()+Math.floor(Math.random()*1000), flag:d.flag, name:d.name, points:d.points}));
    saveTeams(); renderAll(); alert('Ø§Ø³ØªÙŠØ±Ø§Ø¯ ØªÙ… Ø¨Ù†Ø¬Ø§Ø­');
  }catch(err){ alert('ÙØ´Ù„ ÙØ§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯'); }};
  reader.readAsText(f,'utf-8');
}

// Ø²Ø± Ø¥ÙØ±Ø§Øº Ø§Ù„ÙƒÙ„
document.getElementById('resetBtn').onclick = ()=>{
  if(!confirm('Ø¨ØºÙŠØª ØªÙØ±Ù‘Øº Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ®Ø¨Ø§ØªØŸ')) return;
  teams = []; saveTeams(); renderAll();
}

// ØªØ­Ø¯ÙŠØ« Ø³Ø·Ø± Ù…Ø¹Ù„ÙˆÙ…Ø§Øª URL ÙˆÙˆØ¬ÙˆØ¯ Ù…ÙˆÙ‚Ø¹
function updateURLInfo(){ const info = document.getElementById('matchInfo'); /* keep existing text */ }

// ===== ØªÙ‡ÙŠØ¦Ø© Ù…Ø¨Ø¯Ø¦ÙŠØ© =====
(function init(){
  loadTeams();
  // Ø¥Ø°Ø§ Ù…Ø§ÙƒØ§Ù†ÙˆØ´ ÙØ±Ù‚ Ù†Ø¶ÙŠÙÙˆ Ø£Ù…Ø«Ù„Ø©
  if(teams.length===0){
    teams = [
      {id:1, flag:'ğŸ‡²ğŸ‡¦', name:'Ø§Ù„Ù…ØºØ±Ø¨', points:1600},
      {id:2, flag:'ğŸ‡«ğŸ‡·', name:'ÙØ±Ù†Ø³Ø§', points:1750},
      {id:3, flag:'ğŸ‡§ğŸ‡·', name:'Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„', points:1780},
      {id:4, flag:'ğŸ‡¯ğŸ‡µ', name:'Ø§Ù„ÙŠØ§Ø¨Ø§Ù†', points:1520}
    ];
    saveTeams();
  }
  renderAll();
})();

</script>
</body>
</html>
